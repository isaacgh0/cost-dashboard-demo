import{aa as o,ja as p}from"./chunk-P3ISPVFV.js";import{p as d}from"./chunk-7ZV2C32C.js";import{T as u,Z as n,sa as c}from"./chunk-MJUWH32L.js";var f="credentials",v=/^(?=.*[a-z])(?=.*[A-Z])(?=.*\d)(?=.*[&_.:,;@#\-$|¬°!"%\/='?¿¡+*~{}\[\]\(\)^])[a-zA-Z\d&_.:,;@#\-$|¬°!"%\/='?¿¡+*~{}\[\]\(\)^]{8,}$/,m=class a{_router=n(d);_builder=n(p);cookie=window.cookieStore;$authenticated=c(!1);loginForm=this._builder.group({email:["",{nonNullable:!0,validators:[o.required,o.email]}],password:["",{nonNullable:!0,validators:[o.required,o.minLength(8),o.pattern(v)]}]});constructor(){}get authenticated(){return this.$authenticated()}set authenticated(t){this.$authenticated.set(t)}get form(){return this.loginForm}login(){return new Promise((t,e)=>{this.cookie.get("credentials").then(i=>{let{valid:h,value:g}=this.loginForm,r=i?JSON.parse(i.value):null;if(!h)return e({code:"form"});let{email:s,password:l}=g;if(r||this.cookie.set({name:f,value:JSON.stringify({email:s,password:l}),expires:new Date(Date.now()+1e3*60*60*24*7),sameSite:"strict"}),!r||r.email===s&&r.password===l)return this.$authenticated.update(()=>!0),this._router.navigate(["app","home"]),this.loginForm.reset(),t();this.$authenticated.update(()=>!1),e({code:"access"})}).catch(({message:i})=>e({message:i,code:"cookie"}))})}logout(){this.$authenticated.update(()=>!1),this._router.navigate(["login"])}resetAccess(){return new Promise((t,e)=>{this.cookie.delete("credentials").then(()=>(this.$authenticated.update(()=>!1),this._router.navigate(["login"]))).then(()=>t()).catch(i=>e(i))})}static \u0275fac=function(e){return new(e||a)};static \u0275prov=u({token:a,factory:a.\u0275fac,providedIn:"root"})};export{m as a};
